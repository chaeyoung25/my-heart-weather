<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë§ˆìŒë‚ ì”¨ ì²´í¬ì¸</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Gaegu&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Noto Sans KR', sans-serif; }
        body { background-color: #f4f7f6; min-height: 100vh; overflow-x: hidden; }
        
        /* ğŸˆ ë°°ê²½ ì¥ì‹ */
        .background-blob { position: fixed; border-radius: 50%; filter: blur(60px); z-index: -1; opacity: 0.6; }
        .blob-1 { top: -50px; left: -50px; width: 300px; height: 300px; background: #ff9a9e; }
        .blob-2 { bottom: -50px; right: -50px; width: 300px; height: 300px; background: #a18cd1; }
        
        /* ğŸ’ í—¤ë” ë””ìì¸ */
        .glass-header { position: fixed; top: 0; width: 100%; height: 60px; background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255, 255, 255, 0.5); display: flex; justify-content: space-between; align-items: center; padding: 0 20px; z-index: 100; }
        .logo { font-size: 1.2rem; font-weight: bold; color: #333; }
        .admin-active { color: #ff6b6b !important; text-shadow: 0 0 5px rgba(255, 107, 107, 0.5); }
        
        /* ğŸ“Œ ë³´ë“œ ë ˆì´ì•„ì›ƒ */
        #board-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; padding: 80px 20px 20px; max-width: 800px; margin: 0 auto; }
        .loading-msg { text-align: center; color: #888; margin-top: 50px; grid-column: 1 / -1; }
        
        /* ğŸ“ í¬ìŠ¤íŠ¸ì‡ ë””ìì¸ */
        .post-it { padding: 15px; border-radius: 0 0 15px 0; box-shadow: 2px 4px 10px rgba(0,0,0,0.1); cursor: pointer; min-height: 150px; display: flex; flex-direction: column; justify-content: space-between; transition: transform 0.2s; border-top: 1px solid rgba(255,255,255,0.4); position: relative; }
        .post-it:hover { transform: translateY(-5px); }
        .notice-tag { position: absolute; top: -10px; left: 10px; background: #6c5ce7; color: white; font-size: 0.75rem; padding: 3px 10px; border-radius: 15px; font-family: 'Gaegu', cursive; z-index: 5; }
        .my-post-tag { position: absolute; top: -5px; right: -5px; background: #333; color: white; font-size: 0.7rem; padding: 2px 6px; border-radius: 10px; z-index: 10; opacity: 0.8; }
        .comment-badge { background: #ff4757; color: white; font-size: 0.8rem; padding: 3px 8px; border-radius: 20px; margin-top: 5px; text-align: center; font-weight: bold; animation: pulse 2s infinite; display: none; }

        .color-0 { background: #fff4bd; color: #5a4a10; } .color-1 { background: #d4f0f0; color: #1e4a4a; } 
        .color-2 { background: #ffd6e7; color: #5a1e3a; } .color-3 { background: #e2dbf5; color: #3a1e5a; } 
        .color-4 { background: #d4ffd6; color: #1e5a2b; } 

        .post-emoji { font-size: 2rem; margin-bottom: 5px; }
        .post-text { font-size: 0.9rem; line-height: 1.4; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; font-family: 'Gaegu', cursive; margin-bottom: 10px;}
        .post-author { font-size: 0.8rem; font-weight: bold; text-align: right; opacity: 0.7; }

        /* ğŸ–¼ï¸ ëª¨ë‹¬ ì‹œìŠ¤í…œ (ì™„ì „ ìˆ˜ì •) */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); display: none; justify-content: center; align-items: flex-start; z-index: 200; overflow-y: auto; padding: 30px 10px; }
        .modal.show { display: flex; }
        .glass-card { background: #fff; padding: 25px; border-radius: 20px; width: 100%; max-width: 420px; position: relative; margin: auto; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; position: sticky; top: -10px; background: white; z-index: 10; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        
        /* ğŸ“œ ì•ˆë‚´ë¬¸ ê°€ë…ì„± ê°•í™” */
        .notice-body { line-height: 1.8; color: #444; font-size: 0.95rem; }
        .notice-section { margin: 15px 0; padding: 15px; background: #f0f2f5; border-radius: 12px; border-left: 5px solid #6c5ce7; }
        .notice-section h3 { font-size: 1.05rem; margin-bottom: 10px; color: #333; display: flex; align-items: center; gap: 8px; }
        .notice-item { margin-bottom: 10px; display: flex; gap: 8px; align-items: flex-start; }
        .notice-item i { color: #6c5ce7; margin-top: 5px; font-size: 0.8rem; }
        
        /* âŒ¨ï¸ ì…ë ¥ í•„ë“œ */
        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .input-field { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #ddd; outline: none; }
        textarea { width: 100%; border: 1px solid #ddd; padding: 12px; border-radius: 12px; resize: none; margin-bottom: 10px; font-size: 1.1rem; }
        
        .fab { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; border-radius: 50%; background: #333; color: white; border: none; font-size: 1.5rem; cursor: pointer; z-index: 90; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .btn-full { width: 100%; padding: 15px; background: #333; color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; }
        .close-btn { background: #eee; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; justify-content: center; align-items: center; }
        .hidden { display: none !important; }

        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }
        .toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 30px; z-index: 300; display: none; }
    </style>
</head>
<body>
    <div class="background-blob blob-1"></div>
    <div class="background-blob blob-2"></div>

    <header class="glass-header">
        <div class="logo"><i class="fas fa-heart" style="color:#ff6b6b;"></i> ë§ˆìŒë‚ ì”¨</div>
        <button id="btn-admin-mode" style="background:none; border:none; cursor:pointer;"><i class="fas fa-lock"></i></button>
    </header>

    <main id="board-container">
        <div class="loading-msg">ì˜¤ëŠ˜ì˜ ë§ˆìŒë“¤ì„ ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”...</div>
    </main>

    <button id="fab-write" class="fab"><i class="fas fa-pen"></i></button>

    <div id="write-modal" class="modal">
        <div class="glass-card">
            <div class="modal-header">
                <h2 style="font-size:1.2rem;">ì˜¤ëŠ˜ì˜ ë§ˆìŒ ê¸°ë¡</h2>
                <button class="close-btn" onclick="closeAllModals()">&times;</button>
            </div>
            <div id="emotion-grid" style="display:grid; grid-template-columns:repeat(5, 1fr); gap:8px; margin-bottom:15px; max-height: 200px; overflow-y: auto;">
                </div>
            <div class="input-row">
                <input type="text" id="writer-name" class="input-field" placeholder="ë³„ì¹­">
                <input type="password" id="writer-pw" class="input-field" placeholder="ë¹„ë²ˆ(4ì)" maxlength="4">
            </div>
            <textarea id="post-text" placeholder="ë§ˆìŒì† ì´ì•¼ê¸°ë¥¼ ì ì–´ì£¼ì„¸ìš”..." rows="4" style="font-family:'Gaegu', cursive;"></textarea>
            <button id="submit-post" class="btn-full">ê¸°ë¡í•˜ê¸°</button>
        </div>
    </div>

    <div id="view-modal" class="modal">
        <div class="glass-card">
            <div class="modal-header">
                <span id="view-emotion" style="font-size:2rem;">â˜€ï¸</span>
                <div style="display:flex; gap:10px; align-items:center;">
                    <button id="delete-btn" style="color:#ff6b6b; border:1px solid #ff6b6b; background:none; padding:5px 12px; border-radius:20px; font-size:0.85rem; cursor:pointer;"><i class="fas fa-trash"></i> ì‚­ì œ</button>
                    <button class="close-btn" onclick="closeAllModals()">&times;</button>
                </div>
            </div>
            <div id="view-author" style="font-size:0.85rem; color:#888; margin-bottom:15px;">ì‘ì„±ì: -</div>
            <div id="view-content" class="notice-body">
                </div>
            
            <div id="comment-section" style="margin-top:20px; border-top:1px solid #eee; padding-top:15px;">
                <div id="comments-list" style="max-height:180px; overflow-y:auto; margin-bottom:15px; background:#f9f9f9; padding:10px; border-radius:10px;"></div>
                <div class="input-row" style="font-size:0.8rem;">
                    <input type="text" id="c-name" placeholder="ì´ë¦„" style="width:60px; padding:10px; border-radius:10px; border:1px solid #ddd;">
                    <input type="password" id="c-pw" placeholder="ë¹„ë²ˆ" style="width:50px; padding:10px; border-radius:10px; border:1px solid #ddd;">
                    <input type="text" id="c-text" placeholder="ë”°ëœ»í•œ ëŒ“ê¸€" style="flex:1; padding:10px; border-radius:10px; border:1px solid #ddd;">
                    <button id="submit-comment" style="border:none; background:none; color:#007bff; cursor:pointer; font-size:1.2rem;"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast">ì•Œë¦¼ ë©”ì‹œì§€</div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyA-gj2lPOdcsAm0B14d5HRFq7E2KDDXEKo",
          authDomain: "heart-weather-1f20a.firebaseapp.com",
          projectId: "heart-weather-1f20a",
          storageBucket: "heart-weather-1f20a.firebasestorage.app",
          messagingSenderId: "665410309658",
          appId: "1:665410309658:web:950106a5d20ff593e64ba3"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const board = document.getElementById('board-container');
        const writeModal = document.getElementById('write-modal');
        const viewModal = document.getElementById('view-modal');
        const btnAdmin = document.getElementById('btn-admin-mode');
        const todayMidnight = new Date(); todayMidnight.setHours(0, 0, 0, 0);

        let isAdminMode = false;
        let selectedEmo = 'â˜€ï¸';
        let currentDocId = null;
        let currentDocData = null;

        // ğŸ’Œ ë”°ëœ»í•œ ì•ˆë‚´ë¬¸ HTML êµ¬ì¡°
        const NOTICE_HTML = `
            <p style="margin-bottom:10px;">ë‹¹ì‹ ì˜ ë§ˆìŒì´ ì ì‹œ ì‰¬ì–´ê°ˆ ìˆ˜ ìˆëŠ” ê³³, <b style="color:#6c5ce7;">'ë§ˆìŒë‚ ì”¨ ì²´í¬ì¸'</b>ì— ì˜¤ì‹  ê±¸ í™˜ì˜í•´ìš”. ì´ê³³ì€ ì„¸ìƒì˜ ì†ŒìŒì—ì„œ ì ì‹œ ë²—ì–´ë‚˜ ë‚˜ì˜ ë‚´ë©´ì„ ê°€ë§Œíˆ ë§ˆì£¼í•˜ê³ , ì„œë¡œì˜ ì˜¨ê¸°ë¥¼ ë‚˜ëˆ„ëŠ” ì†Œì¤‘í•œ ê³µê°„ì´ì—ìš”.</p>
            <div class="notice-section">
                <h3>ğŸŒ± ìš°ë¦¬ê°€ ì—¬ê¸°ì„œ ë§Œë‚˜ëŠ” ì´ìœ </h3>
                <div class="notice-item"><i class="fas fa-star"></i> <span><b>ê°€ì¥ ë‚˜ë‹¤ìš´ ëª¨ìŠµìœ¼ë¡œ:</b> ëˆ„êµ¬ì—ê²Œë„ ë§í•˜ì§€ ëª»í–ˆë˜ ì†ë§ˆìŒì„ í¸ì•ˆí•˜ê²Œ êº¼ë‚´ì–´ë³´ì„¸ìš”.</span></div>
                <div class="notice-item"><i class="fas fa-star"></i> <span><b>í•¨ê»˜ ë‚˜ëˆ„ëŠ” ë¬´ê²Œ:</b> í˜¼ì ì§Šì–´ì§€ê¸° ë¬´ê±°ìš´ ê³ ë¯¼ë“¤, ì´ì œëŠ” ìš°ë¦¬ ì¡°ê¸ˆì”© ë‚˜ëˆ„ì–´ ë“¤ì–´ë³¼ê¹Œìš”?</span></div>
                <div class="notice-item"><i class="fas fa-star"></i> <span><b>ì†Œë§ì˜ ë°œê²¬:</b> ìœ ë‚œíˆ ê´´ë¡­ê³  í˜ë“  ë‚ , ë”°ëœ»í•œ ê¸€ë“¤ì„ ë³´ë©° ë‹¤ì‹œ ì‹œì‘í•  ìš©ê¸°ë¥¼ ì–»ì–´ ê°€ì„¸ìš”.</span></div>
            </div>
            <div class="notice-section">
                <h3>ğŸˆ í•¨ê»˜ ì˜¨ê¸°ë¥¼ ë‚˜ëˆ„ëŠ” ë°©ë²•</h3>
                <div class="notice-item"><i class="fas fa-heart"></i> <span><b>ë‹¤ì •í•œ ì‹œì„ :</b> ë‹¤ë¥¸ ì´ë“¤ì˜ ë§ˆìŒ ë‚ ì”¨ë¥¼ ì‚´í”¼ë©° ê³µê°ê³¼ ìœ„ë¡œì˜ ë§ˆìŒì„ ê±´ë„¤ì£¼ì„¸ìš”.</span></div>
                <div class="notice-item"><i class="fas fa-heart"></i> <span><b>ì„ ë¬¼ ê°™ì€ í•œë§ˆë””:</b> ë‹¹ì‹ ì´ ë‚¨ê¸´ ë‹¤ì •í•œ ë§ë“¤ì´ ëˆ„êµ°ê°€ì—ê²ŒëŠ” ì˜¤ëŠ˜ì„ ì§€í‚¤ëŠ” ë°©íŒ¨ê°€ ë©ë‹ˆë‹¤.</span></div>
                <div class="notice-item"><i class="fas fa-heart"></i> <span><b>ì‘ì›ì˜ í™•ì¸:</b> ë‚´ ê¸€ì— ë‹¬ë¦° ì§„ì‹¬ ì–´ë¦° ê²©ë ¤ë¥¼ ë§ˆì£¼í•˜ë©° ë‹¤ì‹œê¸ˆ í˜ì„ ì–»ì–´ë³´ì„¸ìš”.</span></div>
            </div>
            <p style="text-align:center; margin-top:20px; font-weight:bold; color:#333;">ë°”ì˜ê²Œ ëŒì•„ê°€ëŠ” ì„¸ìƒ ì†ì—ì„œë„, ëˆ„êµ°ê°€ëŠ” ë°˜ë“œì‹œ ë‹¹ì‹ ì„ ë§ˆìŒ ë‹¤í•´ ì‘ì›í•˜ê³  ìˆë‹¤ëŠ” ê±¸ ê¸°ì–µí•´ ì£¼ì„¸ìš”. âœ¨</p>
            <p style="text-align:center; margin-top:5px; font-size:0.9rem;">ë‚˜ëŠ” ì˜¤ëŠ˜ë„, ì´ë¦„ ëª¨ë¥¼ ë‹¹ì‹ ì˜ í•˜ë£¨ë¥¼ ì§„ì‹¬ìœ¼ë¡œ ì‘ì›í• ê²Œìš”.</p>
        `;

        // ë‹«ê¸° í†µí•© ê´€ë¦¬
        window.closeAllModals = function() {
            writeModal.classList.remove('show');
            viewModal.classList.remove('show');
            document.body.style.overflow = 'auto';
        };

        // ëª¨ë‹¬ ì—´ê¸° ì œì–´
        function openModal(modal) {
            closeAllModals(); // ì¤‘ë³µ ë°©ì§€
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
            modal.scrollTop = 0;
        }

        document.getElementById('fab-write').onclick = () => {
            selectedEmo = 'â˜€ï¸';
            document.getElementById('writer-name').value = '';
            document.getElementById('writer-pw').value = '';
            document.getElementById('post-text').value = '';
            openModal(writeModal);
        };

        // ê°ì • ë²„íŠ¼ ìƒì„±
        const emos = ['â˜€ï¸','â˜ï¸','â˜”','â›ˆï¸','ğŸ¥°','ğŸ¥³','ğŸ˜Œ','ğŸ§¸','ğŸ˜†','ğŸ˜','ğŸ¤©','ğŸ’–','ğŸ¥±','ğŸ¤•','ğŸ¤¯','ğŸ˜°','ğŸ˜¤','ğŸ”¥','âœ¨','â˜ƒï¸'];
        const emoGrid = document.getElementById('emotion-grid');
        emos.forEach(e => {
            const btn = document.createElement('button');
            btn.textContent = e;
            btn.style.cssText = "padding:10px; border:1px solid #eee; background:#fff; border-radius:12px; cursor:pointer; font-size:1.3rem;";
            btn.onclick = () => {
                Array.from(emoGrid.children).forEach(c => c.style.background = '#fff');
                btn.style.background = '#ffeaa7';
                selectedEmo = e;
            };
            emoGrid.appendChild(btn);
        });

        // ë³´ë“œ ë Œë”ë§
        db.collection('posts').where('date', '>=', todayMidnight).orderBy('date', 'desc').onSnapshot(snap => {
            board.innerHTML = '';
            
            // ì•ˆë‚´ í¬ìŠ¤íŠ¸ì‡ (ì‹œìŠ¤í…œ ê³ ì •)
            const notice = document.createElement('div');
            notice.className = "post-it color-3";
            notice.innerHTML = `<div class="notice-tag">âœ¨ ë§ˆìŒì˜ ì‰¼í‘œ</div><div class="post-emoji">ğŸŒ±</div><div class="post-text">ë§ˆìŒë‚ ì”¨ ì²´í¬ì¸ì— ì˜¤ì‹  ê±¸ í™˜ì˜í•´ìš”! í´ë¦­í•´ì„œ ì•ˆë‚´ë¬¸ì„ ì½ì–´ë³´ì„¸ìš”.</div><div class="post-author">From. ë§ˆìŒë‚ ì”¨</div>`;
            notice.onclick = () => {
                currentDocData = { isNotice: true, emotion: 'ğŸŒ±', author: 'ë§ˆìŒë‚ ì”¨' };
                document.getElementById('view-emotion').textContent = 'ğŸŒ±';
                document.getElementById('view-author').textContent = 'ì‘ì„±ì: ë§ˆìŒë‚ ì”¨';
                document.getElementById('view-content').innerHTML = NOTICE_HTML;
                document.getElementById('view-content').style.fontFamily = "'Noto Sans KR', sans-serif";
                document.getElementById('delete-btn').classList.add('hidden');
                document.getElementById('comment-section').classList.add('hidden');
                openModal(viewModal);
            };
            board.appendChild(notice);

            snap.forEach(doc => {
                const data = doc.data();
                const post = document.createElement('div');
                post.className = `post-it color-${data.colorIdx}`;
                post.innerHTML = `<div class="post-emoji">${data.emotion}</div><div class="post-text">${data.text}</div><div class="post-author">From. ${data.author}</div>`;
                post.onclick = () => {
                    currentDocId = doc.id; currentDocData = data;
                    document.getElementById('view-emotion').textContent = data.emotion;
                    document.getElementById('view-author').textContent = `ì‘ì„±ì: ${data.author}`;
                    document.getElementById('view-content').textContent = data.text;
                    document.getElementById('view-content').style.fontFamily = "'Gaegu', cursive";
                    document.getElementById('delete-btn').classList.remove('hidden');
                    document.getElementById('comment-section').classList.remove('hidden');
                    loadComments(doc.id);
                    openModal(viewModal);
                };
                board.appendChild(post);
            });
        });

        // ê´€ë¦¬ì ëª¨ë“œ
        btnAdmin.onclick = () => {
            if (!isAdminMode) {
                const pw = prompt("ê´€ë¦¬ì ì•”í˜¸:");
                if (pw === "0929") {
                    isAdminMode = true;
                    btnAdmin.classList.add('admin-active');
                    showToast("ğŸ‘‘ ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”");
                }
            } else {
                isAdminMode = false;
                btnAdmin.classList.remove('admin-active');
                showToast("ê´€ë¦¬ì ëª¨ë“œ í•´ì œ");
            }
        };

        // ê¸€ ì €ì¥
        document.getElementById('submit-post').onclick = () => {
            const name = document.getElementById('writer-name').value.trim();
            const pw = document.getElementById('writer-pw').value.trim();
            const text = document.getElementById('post-text').value.trim();
            if(!name || !pw || !text) return alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            db.collection('posts').add({
                emotion: selectedEmo, author: name, password: pw, text: text,
                date: firebase.firestore.FieldValue.serverTimestamp(),
                colorIdx: Math.floor(Math.random() * 5)
            }).then(() => { closeAllModals(); showToast("ë§ˆìŒì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! âœ¨"); });
        };

        // ì‚­ì œ ë¡œì§
        document.getElementById('delete-btn').onclick = () => {
            if(!currentDocId || currentDocData.isNotice) return;
            if(!confirm("ì´ ë§ˆìŒ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) return;
            if(isAdminMode) {
                db.collection('posts').doc(currentDocId).delete().then(() => { closeAllModals(); showToast("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."); });
                return;
            }
            const pw = prompt("ë¹„ë°€ë²ˆí˜¸:");
            if(pw === currentDocData.password) {
                db.collection('posts').doc(currentDocId).delete().then(() => { closeAllModals(); showToast("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."); });
            } else if(pw !== null) alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
        };

        // ëŒ“ê¸€ ë¡œì§
        document.getElementById('submit-comment').onclick = () => {
            const name = document.getElementById('c-name').value.trim();
            const pw = document.getElementById('c-pw').value.trim();
            const text = document.getElementById('c-text').value.trim();
            if(!name || !pw || !text) return alert("ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            db.collection('posts').doc(currentDocId).collection('comments').add({
                author: name, password: pw, text: text,
                date: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById('c-text').value = '';
                showToast("ë”°ëœ»í•œ ì‘ì›ì´ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤! â¤ï¸");
            });
        };

        function loadComments(id) {
            const list = document.getElementById('comments-list');
            db.collection('posts').doc(id).collection('comments').orderBy('date').onSnapshot(snap => {
                list.innerHTML = '';
                if(snap.empty) { list.innerHTML = '<p style="text-align:center; color:#ccc; font-size:0.85rem;">ì²« ì‘ì›ì˜ ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”.</p>'; return; }
                snap.forEach(d => {
                    const c = d.data();
                    list.innerHTML += `<div style="font-size:0.9rem; margin-bottom:8px; border-bottom:1px solid #eee; padding-bottom:5px;"><b>${c.author}:</b> ${c.text}</div>`;
                });
            });
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 3000);
        }
    </script>
</body>
</html>